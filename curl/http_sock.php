<?php
/* http_sock.php */
/*
* http://www.codenet.ru/webmast/php/HTTP-POST.php
* http://habrahabr.ru/company/wapstart/blog/139722/
* http://sevidi.ru/php/phppage61.php
* https://code-live.ru/post/cpp-http-server-over-sockets/
*/

/*******************************************************/
function get_content($hostname, $headers) {
	$line = "";

	$fp = fsockopen($hostname, 80, $errno, $errstr);
	
	if (!$fp) echo "$errstr ($errno)<br />\n";
	else {	
		
		// Отправляем запрос
		fwrite($fp, $headers);
		while (!feof($fp)){
			$line .= fgets($fp, 1024);
		}
		fclose($fp);
	}
	return $line;
}
/*******************************************************/



// Устанавливаем большее время работы скрипта
set_time_limit(100);

$hostname = $_GET['url']; //www.cesis.ru
$path = "/";


// USER AGENT
$userAgents=array(
        "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-GB; rv:1.8.1.6) Gecko/20070725 Firefox/2.0.0.6",
        "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)",
        "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; .NET CLR 1.1.4322; .NET CLR 2.0.50727; .NET CLR 3.0.04506.30)",
        "Opera/9.20 (Windows NT 6.0; U; en)",
        "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; en) Opera 8.50",
        "Mozilla/4.0 (compatible; MSIE 6.0; MSIE 5.5; Windows NT 5.1) Opera 7.02 [en]",
        "Mozilla/5.0 (Macintosh; U; PPC Mac OS X Mach-O; fr; rv:1.7) Gecko/20040624 Firefox/0.9",
        "Mozilla/5.0 (Macintosh; U; PPC Mac OS X; en) AppleWebKit/48 (like Gecko) Safari/48"       
);

// HEADERS
$headers = "GET $path HTTP/1.1\r\n" .
"HOST: $hostname\r\n" .
"User-Agent: " . $userAgents[0] .
"Cookie: yandexuid=3768086811471510310" .
"Connection: Close\r\n\r\n";

echo get_content($hostname, $headers); //HOST, HEADERS
?>
